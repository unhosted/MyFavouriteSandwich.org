<!DOCTYPE html>
  <head>
    <title>remoteStorage.js tutorial</title>
    <meta charset="utf-8">
    <script src="http://unhosted.org/require.js" data-main="http://unhosted.org/0.4.1/remoteStorage"></script>
    <script>
      require(['http://unhosted.org/remoteStorage-0.4.2.js'], function(remoteStorage) {

        document.getElementById('connectButton').onclick = function() {
          var userAddress=document.getElementById('userAddress').value;
          remoteStorage.getStorageInfo(userAddress, function(err, storageInfo) {
            if(err) {
              alert('no, sorry!');
            } else {
              alert('yes! look: '+JSON.stringify(storageInfo));
              localStorage.currUserStorageInfo = JSON.stringify(storageInfo);
            }
          });
        }

        document.getElementById('getPublicFooButton').onclick = function() {
          var userAddress=document.getElementById('userAddress').value;
          remoteStorage.getStorageInfo(userAddress, function(err, storageInfo) {
            if(err) {
              alert('could not find the remote storage of '+userAddress);
            } else {
              var client = remoteStorage.createClient(storageInfo, 'public');
              client.get('foo', function(err, data) {
                if(err) {
                  alert('could not find foo on the remote storage of '+userAddress);
                } else {
                  alert(data);
                }
              });
            }
          });
        }
        document.getElementById('doOAuthButton').onclick =  function() {
          var popup = window.open(
            remoteStorage.createOAuthAddress(
              JSON.parse(localStorage.currUserStorageInfo),
              ['public', 'pictures'],
              'https://myfavouritesandwich.org/rcvToken.html'
            )
          );
          popup.onclose = function() {
            alert(localStorage.bearerToken);
          };
        }
        document.getElementById('setPhotoAsAvatarButton').onclick = function() {
          var storageInfo = JSON.parse(localStorage.currUserStorageInfo);
          var publicClient = remoteStorage.createClient(storageInfo, 'public', localStorage.bearerToken);
          var picturesClient = remoteStorage.createClient(storageInfo, 'pictures', localStorage.bearerToken);
          picturesClient.get('foto01', function(err, data) {
            publicClient.put('avatar', data, function(err, data) {
              alert('copied //user@host/pictures#foto01 to //user@host/public#avatar');
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <input id="userAddress" type="text">
    <input type="submit" value="Connect" id="connectButton">
    <input type="submit" value="Get public foo" id="getPublicFooButton">
    <input type="submit" value="Do OAuth" id="doOAuthButton">
    <input type="submit" value="Set Photo as Avatar" id="setPhotoAsAvatarButton">
  </body>
</html>
