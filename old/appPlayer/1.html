<html>
  <head>
    <script src="http://unhosted.org/require.js"></script>
    <script src="syncer.js"></script>
    <script>
      function gup(name) {
        name = name.replace(/[\[]/,'\\\[').replace(/[\]]/,'\\\]');
        var regexS = '[\\?&]'+name+'=([^&#]*)';
        var regex = new RegExp(regexS);
        var results = regex.exec(window.location.href);
        if(results == null) {
          return "";
        } else {
          return results[1];
        }
      }
      var syncer = new Syncer();
      syncer.init({
        api: gup('api'),
        template: gup('template'),
      }, gup('category'), gup('token'), '_unhosted');
      window.addEventListener('storage', function(e) {
        document.getElementById('log').innerHTML += e.key + ' -> ' + e.newValue +'<br>';
        syncer.push(e);
      }, false);
    </script>
  </head>
  <body>
    <input type="submit" value="sync now" onclick="syncer.sync();">
    <div id="log"></div>
  </body>
</html>
